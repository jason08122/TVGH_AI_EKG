<!DOCTYPE html>
<html>
<head>
    <title>TVGH AI EKG</title>
    <h1>TVGH AI EKG Diagnosis</h1>
    <style>
        /* Style the drop area */
        #fileInput {
            width: 300px;
            height: 200px;
            border: 2px dashed #ccc;
            text-align: center;
            padding: 20px;
            margin: 20px auto;
        }
        #uploadForm {
            text-align: center;
        }
        #buttonArea {
            text-align: center;
        }
        #doctorDiag {
            text-align: center;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 33% 33% 33%;
        }
    </style>
</head>
<body>

    <div class="grid-container">

        <div>
            <div>
                <h2 id="patientId">Patient ID: </h2>
                <h2 id="ekgDate">EKG Date: </h2>
                <h2 id="Diagnosis_1">sdddDiagnosis: </h2>
                <ul id="sdddDiagnosis">
                    <li>Systolic: </li>
                    <li>Diastolic: </li>
                    <li>Normal: </li>
                </ul>
                <h2 id="Diagnosis_2">sdDiagnosis: </h2>
                <ul id="sdDiagnosis">
                    <li>Systolic: </li>
                    <li>Normal: </li>
                </ul>
            </div>            
        </div>
        
        <div>
            <div id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="fileInput" name="file">
            </div>    
        
            <div id="buttonArea">
                <button type="button" id="uploadButton" onclick="uploadFile()">Upload File</button>
            </div>

            <div id="doctorDiag">
                <h1>Doctor's diagnosis</h1>
                
                <form>
                    <select id="browserInput" name="browserInput">
                        <option value="Systolic">Systolic</option>
                        <option value="Diastolic">Diastolic</option>
                        <option value="Normal">Normal</option>
                    </select>
                    <button type="button" onclick="submitDoctorDiago()">Submit</button>
                    <p id="submitMesg" style="color:red;"></p>
                </form>
            </div>
        </div>
        
        <div>
          
        </div>
        
    </div>
    

    <script>
        function uploadFile() {
            console.log('uploadFile');
            const form = document.getElementById('uploadForm');
            const fileInput = document.getElementById('fileInput').files[0];
            const formData = new FormData();
            formData.append('file', fileInput);

            fetch('http://140.113.213.56:8000/twoDiagnos/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log('File upload response:', data);
                displayJsonAsHtml(data);
                // Handle the response from the server if needed
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function displayJsonAsHtml(jsonData) {
            console.log('displayJsonAsHtml');
            document.getElementById('patientId').textContent = 'Patient ID: ' + jsonData.Patient_ID;
            document.getElementById('ekgDate').textContent = 'EKG Date: ' + jsonData.EKG_date;
            document.getElementById('Diagnosis_1').textContent = 'sdddDiagnosis: ' + jsonData.sddd_Diagno;
            document.getElementById('sdddDiagnosis').children[0].textContent = 'Systolic: ' + jsonData.sddd_Diagnosis.Systolic;
            document.getElementById('sdddDiagnosis').children[1].textContent = 'Diastolic: ' + jsonData.sddd_Diagnosis.Diastolic;
            document.getElementById('sdddDiagnosis').children[2].textContent = 'Normal: ' + jsonData.sddd_Diagnosis.Normal;
            document.getElementById('Diagnosis_2').textContent = 'sdDiagnosis: ' + jsonData.sd_Diagno;
            document.getElementById('sdDiagnosis').children[0].textContent = 'Systolic: ' + jsonData.sd_Diagnosis.Systolic;
            document.getElementById('sdDiagnosis').children[1].textContent = 'Normal: ' + jsonData.sd_Diagnosis.Normal;
        }
        
        async function submitDoctorDiago() {
            console.log('submitDoctorDiago');

            var patient_id_line = document.getElementById('patientId').textContent;
            var patient_id = patient_id_line.split(":")[1].trim();
            
            var ekg_date_line = document.getElementById('ekgDate').textContent;
            var ekg_date = ekg_date_line.split(":")[1].trim();
            var doctor_diago = document.getElementById('browserInput').value;
            
            if (patient_id_line != 'Patient ID: ' && ekg_date_line != 'EKG Date: ' && doctor_diago)
            {
                console.log(patient_id);
                console.log(ekg_date);
                console.log(doctor_diago);

                // call api to submit
                const url = `http://140.113.213.56:8000/twoDiagnos/doctor/label?id=${patient_id}&date=${ekg_date}&diagnosis=${doctor_diago}`;

                try {
                    const response = await fetch(url);

                    if (response.ok) {
                        console.log('Data submitted successfully!');
                        document.getElementById('submitMesg').textContent = 'Submit successfully!!';
                        setTimeout(function() {
                            document.getElementById('submitMesg').textContent = '';
                            console.log('Erase mesg');
                        }, 3000);
                        // Perform actions after successful submission if needed
                    } else {
                        console.error('Failed to submit data.');
                        document.getElementById('submitMesg').textContent = 'Failed to submit !!';
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
            else
            {
                console.error('Missing data');
                document.getElementById('submitMesg').textContent = 'Missing data !!';
                setTimeout(function() {
                    document.getElementById('submitMesg').textContent = '';
                    console.log('Erase mesg');
                }, 3000);
            }
            
        }

        function helloWorld() {
            console.log('Hello World!!');
        }
    </script>
</body>
</html>
